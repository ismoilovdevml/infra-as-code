---
- name: Configuring Conjur identity on remote hosts fails when missing required SSL config
  hosts: testapp
  tasks:
    - name: Attempt to configure Conjur identity
      block:
        - import_role:
            name: "cyberark.conjur.conjur_host_identity"
          vars:
            conjur_account: cucumber
            conjur_appliance_url: "https://conjur-proxy-nginx"
            conjur_host_factory_token: "{{lookup('env', 'HFTOKEN')}}"
            conjur_host_name: "conjur_{{ ansible_hostname }}"
            # conjur_ssl_certificate: "{{lookup('file', '/cyberark/dev/conjur.pem')}}"
            conjur_validate_certs: yes
      rescue:
        - name: Confirm Role setup fails with message
          assert:
            that: ansible_failed_result.failed == true
            fail_msg: "Variable 'conjur_ssl_certificate' is not set!"
